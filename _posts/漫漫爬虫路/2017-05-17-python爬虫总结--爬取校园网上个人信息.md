---
title: 爬虫总结--爬取校园网个人信息
category: python

---

自己独立写的第一个爬虫,爬取学校的个人信息，记录一下遇到的问题和总结解决办法

### 用代码实现登录，并且访问一个需要登录的网页 ###
1.  在这之前，已经会了使用已经存在的cookie来进行免登录访问.
    然后尝试使用代码登录，然后返回一个response，保存response的cookie值.
    再利用这个cooike尝试免登录访问.
    但是这样是登录不上的.
    重点是**因为忽略了一个问题,浏览器的cooike是真实存在本地的,而我从response获取的只是一个cookie的符号,并没有真实信息**.所以是登录不上的.

2.  解决办法.
    一开始想的是将response的cookie值保存到本地.但是没有实现
    后来发现requests库有`resquests.Session`对象,用它登录，然后和服务器建立一个会话，然后用这个会话取访问需要访问的页面.


### re匹配中文 ###
1.  因为还没有接触过dom解析，所以使用re来匹配需要的信息,但是遇到了几个问题.第一个是无法匹配中文.
    无法匹配中文的原因大概了解了一下，是应为编码的缘故,将要匹配的源和匹配的表达式都转换成`bytes`为单位的编码，便能成功匹配了.
2.  一开始是看浏览器上面的源码，从而提取出关系，进行匹配，但是空格是被浏览器解析成空格了的.然而一一开始不知道，就直接在匹配表达式中输入空格，结果怎么都匹配不上.
    结果后来把抓下来的源码打印出来，才发现空格是的源码是`&nbsp`，而不是空格.
    **所以以后提取信息的时候不要完全相信浏览器上看到的源码，要根据抓下来的源码.**


### 多线程之间的数据共享和缓冲问题 ###
1.  因为使用了多线程爬，然后将爬到的信息是放入一个队列,另外的线程在取这些信息进行相应的处理,所以这里面就涉及到了同步的问题.
    这是典型的生产者消费者模型,所以需要一把同步锁,然后也不应该一直等,所以有两个条件变量,一个生产者，一个消费者.然后这两个条件变量使用同以把锁.这样就可以通过条件变量来指定wait的线程以及唤醒的线程了.
2.  线程被唤醒之后的执行位置
    一开始不知道线程被唤醒时是从哪儿开始执行的,所以使用的是if来判断wait条件
```python
if len(q) <= 0:
    cond.wait()
```

然后当线程被唤醒后，是直接从wait的地方开始执行,所以被唤醒后却可能出现队列为空的情况,所以需要被唤醒之后再次判断.

```python
while len(q) <= 0:
    cond.wait()
```
