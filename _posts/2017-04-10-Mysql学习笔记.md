---
title: MySql学习笔记,半教程
category: mysql
excerpt: |
  对MySql学习过程的记录，形成笔记，供日后查询。
---

## 安装与配置，初次接触数据库
- 在mysql的安装目录下，mysql的配置文件，其中有个用户配置文件叫做my.ini,用户可以修改其来进行自己的配置。

```mysql
[client]
# port: mysql的端口号,默认为3306
port=3306

[mysql]
# default-character-set: 默认字符集
default-character-set=uft8

# mysqld:mysql服务器端的一些配置 
[mysqld]
port=3306

# 基础的安装路径
basedir="xxx"	

# datadir:数据的存放路径
datadir="xxxx"

# character-set-server:服务器的字符集
character-set-server=utf8
```

- 重启mysql来应用配置
    - windows: `net start/stop mysql`
    - linux: `sudo service mysql start/stop`
    
- 登陆mysql
`mysql [-选项]`, eg:`mysql -uroot -p`
    - -D, --database=name 指定数据库名称
    - --delimiter=name 指定分隔符
    - -h, --host=name 服务器名称
    - -p, --password 密码
    - -P, --port=# 端口号
    - --prompt=name  设置提示符
    - -u, --user=name 用户名
    - -V, --version 查看版本号
    
- 登出:
```mysql
mysql>exit;
mysql>quit;
mysql>\q;
```

- 修改mysql提示符：
    - 链接服务器的时候修改：
    `mysql -uusername -ppassword --prompt promptname`
    - 登陆成功后通过命令修改
    `mysql> prompt promptname;`

其中`promptname`可以是以下参数: eg:`mysql>pormpt \u@\h \d>;`
```mysql
\D 完整的日期
\d 当前的数据库
\h 服务器名称
\u 当前用户
```

- mysql常用命令
```mysql
# 显示数据库版本
SELECT VERSION(); 
# 显示当前用户
SELECT USER();
#显示当前日期
SELECT NOW();
```

- MySql语句的规范
    - 关键字与函数全部大写
    - 数据库名称，表名称，字段名称全部小写
    - 语句必须以‘;’结尾。
    
    
- 创建数据库：`CREATE {DATABAS , ESCHEMA} [IF NOT EXISTS] db_name [DEFAULT] CHARACTER SET [=] charset_name;`
    - \{\}为必选项，在 , 之间选一个
    - []为可选项。
    - eg: `CREATE DATABASE t1;`
    
- 查看当前服务器下的数据库:` SHOW DATABASES;`

- 使用参数创建数数据库: 
    - 我们上面创建了一个叫做 t1 的数据库，如果我们重复执行命令，在创建一个叫做t1的数据亏，这系统会给我们报错。
    - 我们加上参数再次创建同名数据库:`CREATE DATABASE  IF NOT EXISTS t1;`,此时系统没有给我们报错，返回了OK，只是提示有一个警告。
    - 我们可以使用命令`SHOW WARINGS;`来查看警告。
    
- 查看数据库创建的指令:`SHOW CREATE DATABASE db_name;`
    - 这个命令可以显示数据库创建的命令，能看到字符集等。
    
- 修改已存在数据库：`ALTER {DATABASE , SCHEMA} [db_name] [DEFAULT] CHARACTER SET [=] charset_name;`
    - eg:`ALTER DATABASE t1 CHARACTER SET = gbk;`
    
- 删除数据库:`DROP {DATABASE , SCHEMA} [IF EXISTS] db_name;`
    - eg: `DROP DATABASES t1;`


## 数据类型与操作数据库

- 数据类型：

- 整型：
    - `TINYINT`: 占一个字节
        - 有符: -128~127 之间(-2^7~2^7-1)
        - 无符(UNSIGNED): 0~255
    - `SMALLINT`:占2个字节
        - 有符: -32768~32767(-2^15~2^15-1)
        - 无符:0~65535
    - `MEDIUMINT`:占3个字节
        - 大小为2^24 
    - `INT`:占4字节
        - 大小:2^32
    - `BIGINT`:占8字节
        - 大小:2^64
        
- 浮点型:
    - `FLOAT[(M,D)]`:M:总位数， D:小数点位数。M,D都可以省略，则更具硬件限制来保存值，但精度大约是小数点后7为。
    - `DOUBLE`:范围大约是但进度的两倍
    
- 日期时间类型:
    - `YEAR`:年，默认四位
    - `TIME`:时间，-8385959~8385959
    - `DATE`:日期，1000.1.1~9999.12.31 
    - `DATETIME`:时间日期，
    - `TIMESTAMP`:时间戳，1970.1.1-2037
    
- 字符型:
    - `CHAR(M)`:定长类型，M个字节, 不足的补空格， 0<= M <= 255.
    - `VARCHAR(M)`:变长类型，村Length+1个字节，Length < M, 0 <= M <= 65535.
    - `TINYTEXT`: L+1个字节， L < 2^8.
    - `TEXT`: L+2, L < 2^16.
    - `MEDIUMTEXT`: L+3, L < 2^24.
    - `LONGTEXT`: L+4, L < 2^32.
    - `ENUM('value1', 'value2', 'value3', .....)`:枚举类型，只能选一个，最多65535个值。
    - `SET('value1', 'value2', 'value3', ......)`:集合类型，可以任选个数，最多64个成员。
    
- 数据表：数据库的重要组成，是其他对象的基础。

数据表是一个二维表格，有行和列， 行称为记录，列称为字段。

- 打开数据库: `USE db_name;`

- 查看当前的数据库: `SELECT DATABASE();`

- 创建数据表: 
```mysql
CREATE TABLE [IF NOT EXISTS] table_name(
	column_name data_type,
	......
	column_name data_type
);

eg:
CREATE TABLE person(
	username VARCHAR(20),
	age TINTYINT UNSIGNED,
	salary FLOAT(6,2) UNSIGNED
);
```

- 查看数据表:`SHOW TABLES [FROM db_name] [LIKE 'pattern', WHERE expression];`
```mysql
eg:
SHOW TABLES FROM mysql;
```

- 查看表结构: `SHOW COLUMNS FROM table_name;`

- 插入数据:`INSERT [INTO] table_name [(column_name1, column_name2, ...)] VALUES(value1, value2, ...);`
```mysql
eg:
# 省略column_name,则默认为所有字段赋值
INSERT person VALUES('Tom', 25, 234.523);

# 只为部分字段赋值
INSERT person (username, age) VALUES('Tim', 30);
```

- 查找: `SELECT expression, .... FROM table_name;`
```mysql
eg:
SELECT username, age FROM person;
```

- 空值与非空:在建表的时候在字段后面加上`NULL` or `NOT NULL`,默认为NULL,允许为空。
```mysql
CREATE TABLE table1(
	username VARCHAR(20) NOT NULL;
);
```

- 主键:字段后面加上`PRIMARY_KEY`
    - 一张表只能存在一个主键
    - 主键不能重复，不能空，保证了记录的唯一性
    - 主键自动为`NOT NULL`

- 自动编号:在建表的时候字段后面加上`AUTO_INCREMENT`.
    - 必须与主键组合使用,具有主键的所有特性.
    - 必须为数字.
    - 默认起始为1， 每次增量为1.
    - 可以不为这个字段赋值，他会自动增加.
```mysql
CREATE TABLE table1(
	id SMALLINT UNSIGNED AUTO_INCREMENT PRIMARY_KEY,
	username VARCHAR(20) NOT NULL;
	age SMALLINT UNSIGNED
);
```

- 唯一约束:在字段后面加上`UNIQUE_KEY`
    - 可一保证记录的唯一性.
    - 一张表可以有多个.
    - 唯一约束可以为NULL.多个NULL会被认为是一个 NULL.
    
    
- 默认约束:在字段后面加上`DEFAULT value`
    - 当不进行赋值时字段的默认值.
    
    
    
## 约束以及修改数据表
- 约束:
    - 约束是为了保证数据的完整性和一致性
    - 约束还分为表级约束和列级约束
        - 如果约束只针对某一个字段使用，称为列级约束.
        - 如果约束针对两个和以上的字段使用，称为表级约束.
    - 约束包括:
        - `NOT NULL`(非空约束)
        - `PRIMARY KEY`(主键约束)
        - `UNIQUE KEY`(唯一约束)
        - `DEFAULT`(默认约束)
        - `FOREIGN KEY`外键约束)
        
- 外键约束:
    - 保持数据一致性，完整性
    - 实现一对一或多对一关系
    - 父表和子表必须使用相同的存储引擎，禁止使用临时表。
        - 子表：具有外键的表。
        - 父表： 相对于子表的参照表。
    - 数据表的存储引擎只能为INNODB
        - default-storage-engine=INNODB,在配置文件中修改。
    - 子表和父表的字段类型必须同一种或相似类型。
        - 数字型必须完全相同，包括符号
        - 字符型可以不同类型。
        
- 3-3外键的约束，重新学习。


- 添加数据列:`ALTER TABLE table_name ADD [COLUMN] column_name column_definition [FIRST, AFTER col_name]`
    - 如果不指定`FIRST` or `AFTER`, 则默认插在最后。
    - 可以同时添加多列，添加的列用()括起来，中间用’,‘隔开
    - 添加多列是不能制定添加位置
```mysql
eg:
ALTER TABLE person ADD height TINYINT UNSIGNED NOT NULL AFTER age;
```

- 删除数据列: `ALTER TABLE table_name DROP column_name;`

- 同时进行多个操作:`ALTER TABLE table_name (DROP, ADD) column_name1, (DROP, ADD) column_name1,  (DROP, ADD) column_name1, ....; `

- 添加主键约束:`ALTER TABLE table_name ADD [CONSTRAINT [symbol]] PRIMARY KEY [insex_type] (index_col_name, ...)`
    - 如果加上CONSTRAINT, 则可以为这个约束起名字 symbol
```mysql
eg:
ALTER TABLE person ADD CONSTRAINT PK_person_id PRIMARY KEY (id);
```

- 添加唯一约束:``ALTER TABLE table_name ADD [CONSTRAINT [symbol]] UNIQUE [INDEX, KEY] [index_name] [index_type] (index_col_name, ...);`

- 添加外键约束: `ALTER TABLE table_name ADD [CONSTRAINT [symbol]] FOREGIN KEY [instx_name] (index_col_name, ...) reference_definition;`

```mysql
eg:
# 设置provinces 表中的id为person表中pid的外键.
ALTER TABLE person ADD FOREIGN KEY (pid) REFERENCES provinces (id);
```

- 添加/删除默认约束:`ALTER TABLE table_name ALTER [COLUMN] column_name {SET DEFAULT literal, DROP DEFAULT}`

```mysql
eg:
ALTER TABLE person ALTER age SET DEFAULT 15;
ALTER TABLE person ALTER age DROP DEFAULT;
```